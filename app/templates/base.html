<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ app_name or "Captain's Log" }} - {{ vessel_name or "SV DEFIANT" }}{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', path='/favicon.svg') }}" type="image/svg+xml">
    <link rel="icon" href="{{ url_for('static', path='/favicon-32x32.png') }}" sizes="32x32" type="image/png">
    <link rel="icon" href="{{ url_for('static', path='/favicon-16x16.png') }}" sizes="16x16" type="image/png">
    <link rel="apple-touch-icon" href="{{ url_for('static', path='/favicon-32x32.png') }}"  sizes="32x32">
    <link rel="stylesheet" href="{{ url_for('static', path='/css/lcars.css') }}">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    {% block head %}{% endblock %}
</head>
<body>
    <div class="lcars-frame">
        <!-- Top Elements -->
        <div class="lcars-top-left">
            <h3>{{ vessel_name or "SV DEFIANT" }}</h3>
            <div>
                <small style="font-size: 10px;">{{ vessel_designation or "NCC-75633" }}</small>
            </div>
        </div>

        <div class="lcars-top-bar">
            {% block page_title %}{{ app_name or "CAPTAIN'S LOG" }}{% endblock %}
        </div>

        <div class="lcars-top-right">
            {% if current_user %}
            <div class="user-info">
                <div class="username">{{ current_user.username }}</div>
            </div>
            {% endif %}
        </div>

        <!-- Side Bars -->
        <div class="lcars-left-bar">
            <a href="/" class="lcars-element {% if request.url.path == '/' %}active{% endif %}">
                LOGS
            </a>
            <a href="/record" class="lcars-element {% if request.url.path == '/record' %}active{% endif %}">
                RECORD
            </a>
            <a href="/map" class="lcars-element {% if request.url.path == '/map' %}active{% endif %}">
                MAP
            </a>
            <a href="/search" class="lcars-element {% if request.url.path == '/search' %}active{% endif %}">
                SEARCH
            </a>
            <a href="/settings" class="lcars-element {% if request.url.path == '/settings' %}active{% endif %}">
                SETTINGS
            </a>
            <a href="/status" class="lcars-element {% if request.url.path == '/status' %}active{% endif %}">
                STATUS
            </a>
            {% if current_user %}
            <a href="#"
               onclick="logout(); return false;"
               class="lcars-element"
               style="margin-top: auto;">
                LOGOUT
            </a>
            {% endif %}
        </div>

        <div class="lcars-right-bar"></div>

        <!-- Main Content -->
        <div class="lcars-content">
            {% block content %}{% endblock %}
        </div>

        <!-- Bottom Elements -->
        <div class="lcars-bottom-left"></div>

        <div class="lcars-bottom-bar">
            <span>LOG SYSTEM v{{ version or "1.0" }}</span>
            <span>{{ current_time or "STARDATE 2025.323" }}</span>
        </div>

        <div class="lcars-bottom-right"></div>
    </div>

    <!-- Global Scripts -->
    <script>
        // Global HTMX configuration
        htmx.config.globalViewTransitions = true;

        // Logout function
        async function logout() {
            try {
                const response = await fetch('/api/auth/jwt/logout', {
                    method: 'POST',
                    credentials: 'include'
                });

                if (response.ok) {
                    // Redirect to login page after successful logout
                    window.location.href = '/login';
                } else {
                    console.error('Logout failed');
                }
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Responsive breakpoint system
        function updateBreakpoint() {
            const screen = document.getElementById('screen');
            const width = window.innerWidth;
            const height = window.innerHeight;

            // Remove all breakpoint classes
            screen.classList.remove('XS', 'SM', 'MD', 'LG', 'XL', 'XXL');

            // Add appropriate breakpoint class
            if (width < 576 || height < 576) {
                screen.classList.add('XS');
            } else if (width < 768 || height < 768) {
                screen.classList.add('SM');
            } else if (width < 992 || height < 992) {
                screen.classList.add('MD');
            } else if (width < 1200 || height < 1200) {
                screen.classList.add('LG');
            } else if (width < 1400 || height < 1400) {
                screen.classList.add('XL');
            } else {
                screen.classList.add('XXL');
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateBreakpoint();
        });

        // Update on window resize
        window.addEventListener('resize', updateBreakpoint);

        // LCARS sound effects (optional)
        function playLcarsSound(type = 'button') {
            // Implement LCARS sound effects if desired
            // For now, just a simple beep
            if (window.AudioContext || window.webkitAudioContext) {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = type === 'button' ? 800 : 600;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);

                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            }
        }

        // Add sound to all LCARS buttons
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('lcars-button') || e.target.classList.contains('lcars-nav-item') || e.target.classList.contains('linkable')) {
                playLcarsSound('button');
            }
        });
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>